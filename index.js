// å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’èª­ã¿è¾¼ã‚€ const express = require('express'); const line = require('@line/bot-sdk'); // LINE Botã®è¨­å®šï¼ˆç’°å¢ƒå¤‰æ•°ã‹ã‚‰å–å¾—ï¼‰ const config = { channelAccessToken: process.env.LINE_CHANNEL_ACCESS_TOKEN, channelSecret: process.env.LINE_CHANNEL_SECRET }; // LINEã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä½œæˆ const client = new line.Client(config); // Expressã‚¢ãƒ—ãƒªã‚’åˆæœŸåŒ– const app = express(); app.use(express.json()); // Webhookã®å—ã‘å£ app.post('/webhook', line.middleware(config), (req, res) => { const events = req.body.events; // è¤‡æ•°ã‚¤ãƒ™ãƒ³ãƒˆã‚’å‡¦ç† Promise.all(events.map(handleEvent)) .then(() => res.status(200).end()) .catch((err) => { console.error('Webhook Error:', err); res.status(500).end(); }); }); // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‡¦ç†ãƒ­ã‚¸ãƒƒã‚¯ function handleEvent(event) { if (event.type !== 'message' || event.message.type !== 'text') { return Promise.resolve(null); } const userMessage = event.message.text.trim(); // èª•ç”Ÿæ—¥å½¢å¼ï¼ˆYYYY/MM/DDï¼‰ã‹åˆ¤å®š if (/^\d{4}\/\d{2}\/\d{2}$/.test(userMessage)) { const replyText = getFortune(userMessage); return client.replyMessage(event.replyToken, { type: 'text', text: replyText }); } // èª•ç”Ÿæ—¥ä»¥å¤–ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã¯æ¡ˆå†…ã‚’è¿”ã™ return client.replyMessage(event.replyToken, { type: 'text', text: 'èª•ç”Ÿæ—¥ã‚’ã€Œ1990/01/01ã€ã®ã‚ˆã†ã«é€ã£ã¦ãã ã•ã„ðŸ˜Š' }); } // å ã„ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆç°¡æ˜“ç‰ˆï¼‰ function getFortune(birthday) { const [year, month, day] = birthday.split('/'); const seed = parseInt(month + day); const fortunes = [ 'æŒ‘æˆ¦ã®æ˜Ÿ', 'ç™’ã—ã®é¢¨', 'é©å‘½ã®ç‚Ž', 'é™å¯‚ã®æœˆ', 'æ‹¡å¼µã®æ³¢', 'ç›´æ„Ÿã®å…‰', 'æŽ¢æ±‚ã®å½±', 'å…±é³´ã®éŸ³' ]; const result = fortunes[seed % fortunes.length]; // noteãƒªãƒ³ã‚¯ã«å¤‰æ›ï¼ˆä¾‹ï¼š19900101ï¼‰ const noteCode = birthday.replace(/\//g, ''); return `ðŸŽ‰${birthday}ç”Ÿã¾ã‚Œã®ã‚ãªãŸã®é‹å‹¢ã¯ã€Œ${result}ã€ï¼\nðŸ‘‰ è©³ã—ãã¯ã“ã¡ã‚‰ï¼šhttps://note.com/uranai_guide/${noteCode}`; } // ãƒãƒ¼ãƒˆè¨­å®šï¼ˆVercelã§ã¯ä¸è¦ã ãŒãƒ­ãƒ¼ã‚«ãƒ«ç”¨ï¼‰ const port = process.env.PORT || 3000; app.listen(port, () => { console.log(`LINE Bot is running on port ${port}`); });
