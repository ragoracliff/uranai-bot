const express = require('express'); const line = require('@line/bot-sdk'); const config = { channelAccessToken: process.env.LINE_CHANNEL_ACCESS_TOKEN, channelSecret: process.env.LINE_CHANNEL_SECRET }; const client = new line.Client(config); const app = express(); app.use(express.json()); app.post('/webhook', line.middleware(config), (req, res) => { const events = req.body.events; Promise.all(events.map(handleEvent)) .then(() => res.status(200).end()) .catch((err) => { console.error('Webhook Error:', err); res.status(500).end(); }); }); function handleEvent(event) { if (event.type !== 'message' || event.message.type !== 'text') { return Promise.resolve(null); } const userMessage = event.message.text.trim(); if (/^\d{4}\/\d{2}\/\d{2}$/.test(userMessage)) { const replyText = getFortune(userMessage); return client.replyMessage(event.replyToken, { type: 'text', text: replyText }); } return client.replyMessage(event.replyToken, { type: 'text', text: 'èª•ç”Ÿæ—¥ã‚’ã€Œ1990/01/01ã€ã®ã‚ˆã†ã«é€ã£ã¦ãã ã•ã„ðŸ˜Š' }); } function getFortune(birthday) { const [year, month, day] = birthday.split('/'); const seed = parseInt(month + day); const fortunes = [ 'æŒ‘æˆ¦ã®æ˜Ÿ', 'ç™’ã—ã®é¢¨', 'é©å‘½ã®ç‚Ž', 'é™å¯‚ã®æœˆ', 'æ‹¡å¼µã®æ³¢', 'ç›´æ„Ÿã®å…‰', 'æŽ¢æ±‚ã®å½±', 'å…±é³´ã®éŸ³' ]; const result = fortunes[seed % fortunes.length]; const noteCode = birthday.replace(/\//g, ''); return `ðŸŽ‰${birthday}ç”Ÿã¾ã‚Œã®ã‚ãªãŸã®é‹å‹¢ã¯ã€Œ${result}ã€ï¼\nðŸ‘‰ è©³ã—ãã¯ã“ã¡ã‚‰ï¼šhttps://note.com/uranai_guide/${noteCode}`; } const port = process.env.PORT || 3000; app.listen(port, () => { console.log(`LINE Bot is running on port ${port}`); });
