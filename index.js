// 必要なライブラリを読み込む const express = require('express'); const line = require('@line/bot-sdk'); // LINE Botの設定（環境変数から取得） const config = { channelAccessToken: process.env.LINE_CHANNEL_ACCESS_TOKEN, channelSecret: process.env.LINE_CHANNEL_SECRET }; // LINEクライアントを作成 const client = new line.Client(config); // Expressアプリを初期化 const app = express(); app.use(express.json()); // Webhookの受け口 app.post('/webhook', line.middleware(config), (req, res) => { const events = req.body.events; // 複数イベントを処理 Promise.all(events.map(handleEvent)) .then(() => res.status(200).end()) .catch((err) => { console.error('Webhook Error:', err); res.status(500).end(); }); }); // メッセージ処理ロジック function handleEvent(event) { if (event.type !== 'message' || event.message.type !== 'text') { return Promise.resolve(null); } const userMessage = event.message.text.trim(); // 誕生日形式（YYYY/MM/DD）か判定 if (/^\d{4}\/\d{2}\/\d{2}$/.test(userMessage)) { const replyText = getFortune(userMessage); return client.replyMessage(event.replyToken, { type: 'text', text: replyText }); } // 誕生日以外のメッセージには案内を返す return client.replyMessage(event.replyToken, { type: 'text', text: '誕生日を「1990/01/01」のように送ってください😊' }); } // 占いロジック（簡易版） function getFortune(birthday) { const [year, month, day] = birthday.split('/'); const seed = parseInt(month + day); const fortunes = [ '挑戦の星', '癒しの風', '革命の炎', '静寂の月', '拡張の波', '直感の光', '探求の影', '共鳴の音' ]; const result = fortunes[seed % fortunes.length]; // noteリンクに変換（例：19900101） const noteCode = birthday.replace(/\//g, ''); return `🎉${birthday}生まれのあなたの運勢は「${result}」！\n👉 詳しくはこちら：https://note.com/uranai_guide/${noteCode}`; } // ポート設定（Vercelでは不要だがローカル用） const port = process.env.PORT || 3000; app.listen(port, () => { console.log(`LINE Bot is running on port ${port}`); });
